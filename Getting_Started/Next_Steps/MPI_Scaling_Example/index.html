
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="NeSI Support Documentation">
      
      
      
        <link rel="canonical" href="https://github.com/nesi/support-docs-concept/Getting_Started/Next_Steps/MPI_Scaling_Example/">
      
      
        <link rel="prev" href="../Job_Scaling_Ascertaining_job_dimensions/">
      
      
        <link rel="next" href="../Multithreading_Scaling_Example/">
      
      
      <link rel="icon" href="../../../assets/icons/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.7">
    
    
      
        <title>MPI Scaling Example - NeSI Support Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/neoteroi-mkdocs.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/footer.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/custom_admonations.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/theme.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-TVQR4R1F40"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-TVQR4R1F40",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-TVQR4R1F40",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#initial-python-script" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
<style>
#banner{
    font-size: larger;
    text-align: center;
    background:  var(--md-warning-bg-color);
}
#banner a:link {
    color: blue;
}
#banner a:visited {
    color: purple;
}
#banner a:focus,
#banner a:hover {
    border-bottom: 1px solid;
}
#banner p{
    color: black;
}
</style>

<div id="banner">
    <p>This site is in Beta. All content is a duplication of  
    <a href="https://support.nesi.org.nz/hc/en-gb">offical NeSI support documentation.</a>
    </p>
</div>

      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="NeSI Support Documentation" class="md-header__button md-logo" aria-label="NeSI Support Documentation" data-md-component="logo">
      
  <img src="../../../assets/icons/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NeSI Support Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MPI Scaling Example
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/nesi/support-docs-concept" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    


    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="NeSI Support Documentation" class="md-nav__button md-logo" aria-label="NeSI Support Documentation" data-md-component="logo">
      
  <img src="../../../assets/icons/logo.svg" alt="logo">

    </a>
    NeSI Support Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nesi/support-docs-concept" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Accounts-Projects_and_Allocations/Creating_a_NeSI_Account_Profile/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Accounts, Projects and Allocations
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Accessing_the_HPCs/Setting_Up_and_Resetting_Your_Password/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Accessing the HPCs
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" checked>
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Next Steps
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            Next Steps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Moving_files_to_and_from_the_cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Moving files to and from the cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Submitting_your_first_job/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Submitting your first job
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Parallel_Execution/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parallel Execution
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Finding_Job_Efficiency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Finding Job Efficiency
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Job_Scaling_Ascertaining_job_dimensions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Job Scaling - Ascertaining job dimensions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    MPI Scaling Example
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    MPI Scaling Example
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-python-script" class="md-nav__link">
    <span class="md-ellipsis">
      Initial Python Script
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Initial Python Script">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#revised-python-script" class="md-nav__link">
    <span class="md-ellipsis">
      Revised Python Script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slurm-script" class="md-nav__link">
    <span class="md-ellipsis">
      Slurm Script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estimating-our-total-resource-requirments" class="md-nav__link">
    <span class="md-ellipsis">
      Estimating our Total Resource Requirments
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Estimating our Total Resource Requirments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#revised-slurm-script" class="md-nav__link">
    <span class="md-ellipsis">
      Revised Slurm Script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Multithreading_Scaling_Example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multithreading Scaling Example
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../The_HPC_environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The HPC environment
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Getting_Help/NeSI_wide_area_network_connectivity/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Getting Help
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Cheat_Sheets/Bash-Reference_Sheet/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Cheat Sheets
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../my-nesi-org-nz/Logging_in_to_my-nesi-org-nz/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    my.nesi.org.nz
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../General/Announcements/Accessing_NeSI_Support_during_the_holiday_break/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    General
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../Scientific_Computing/Supported_Applications/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Scientific Computing
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../Storage/File_Systems_and_Quotas/NeSI_File_Systems_and_Quotas/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Storage
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-python-script" class="md-nav__link">
    <span class="md-ellipsis">
      Initial Python Script
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Initial Python Script">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#revised-python-script" class="md-nav__link">
    <span class="md-ellipsis">
      Revised Python Script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slurm-script" class="md-nav__link">
    <span class="md-ellipsis">
      Slurm Script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estimating-our-total-resource-requirments" class="md-nav__link">
    <span class="md-ellipsis">
      Estimating our Total Resource Requirments
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Estimating our Total Resource Requirments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#revised-slurm-script" class="md-nav__link">
    <span class="md-ellipsis">
      Revised Slurm Script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                

                  

  
    <a href="https://github.com/nesi/support-docs-concept/edit/main/docs/Getting_Started/Next_Steps/MPI_Scaling_Example.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


  <h1>MPI Scaling Example</h1>

<!-- TODO review the scripts, it looks like there is a missing word after $ -->

<p>In the example below we will use Python scripts to demonstrate how you
might perform some basic scaling tests, however, the principles outlined
in these examples are applicable across software applications. You do
not need to know anything about Python to understand this article; it
was merely chosen for the purpose of illustration.</p>
<h2 id="initial-python-script">Initial Python Script<a class="headerlink" href="#initial-python-script" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1"># Imports numpy and mpi4py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>

<span class="c1"># Retrieves MPI environment</span>
<span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
<span class="c1"># Sets size as the total number of MPI tasks</span>
<span class="n">size</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span>
<span class="c1"># Sets rank as the specific MPI rank on all MPI tasks</span>
<span class="n">rank</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>
<span class="c1"># sets x and y dimensions which will be used for the generated matrix</span>
<span class="n">matrix</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">seeds</span> <span class="o">=</span> <span class="mi">60000</span>

<span class="c1"># If the rank is 0 (master) then create a list of numbers from 0-4999 and then</span>
<span class="c1"># split those seeds number equally amoung size groups, other set seeds and</span>
<span class="c1"># split_seeds to $</span>
<span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">seeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">seeds</span><span class="p">)</span>
    <span class="n">split_seeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">seeds</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">seeds</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">split_seeds</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Scatter the seeds among each MPI task</span>
<span class="n">rank_seeds</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">split_seeds</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1"># Create a array of zeros of the lenght of the MPI tasks seeds</span>
<span class="n">rank_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rank_seeds</span><span class="p">))</span>

<span class="c1"># For each number from 0 to the number of the MPI tasks, list of seeds and use</span>
<span class="c1"># one of those seeds to set the random seed (ensuring each random seed is</span>
<span class="c1"># different). Then create an array of random numbers with x and y equal to the</span>
<span class="c1"># matrix variable. Then calculate the dot product of the array with itself.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rank_seeds</span><span class="p">)):</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="n">rank_seeds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span><span class="n">matrix</span><span class="p">)</span>
    <span class="n">data_mm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">rank_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">data_mm</span><span class="p">))</span>
<span class="n">rank_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">rank_data</span><span class="p">)</span>

<span class="n">data_gather</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">rank_sum</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">data_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data_gather</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Gathered data:&#39;</span><span class="p">,</span> <span class="n">data_gather</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sum:&#39;</span><span class="p">,</span> <span class="n">data_sum</span><span class="p">)</span>
</code></pre></div>
<p>You do not need to understand what the above Python script is doing,
but for context, the script will create a list of numbers and split them
between the available MPI tasks (ranks) then uses those numbers as seeds
to create arrays of random numbers. The dot product of each array is
then calculated and those numbers are summed together and sent back to
the master task (via MPI) and all those numbers are summed together and
the results are printed. The script will take the number of MPI tasks
from the environment and and run it in parallel with that many ranks. We
unfortunately do not know how many CPUs, how much memory (RAM) or how
much time to request for this script to complete. This means the first
thing we need to do is run a small scale test and see how long that runs
for. So we will first try with 5,000 seeds rather than 60,000 seeds.</p>
<h3 id="revised-python-script">Revised Python Script<a class="headerlink" href="#revised-python-script" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Imports numpy and mpi4py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>

<span class="c1"># Retrieves MPI environment</span>
<span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
<span class="c1"># Sets size as the total number of MPI tasks</span>
<span class="n">size</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span>
<span class="c1"># Sets rank as the specific MPI rank on all MPI tasks</span>
<span class="n">rank</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>
<span class="c1"># sets x and y dimensions which will be used for the generated matrix</span>
<span class="n">matrix</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">seeds</span> <span class="o">=</span> <span class="mi">5000</span>

<span class="c1"># If the rank is 0 (master) then create a list of numbers from 0-4999 and then</span>
<span class="c1"># split those seeds number equally amoung size groups, other set seeds and</span>
<span class="c1"># split_seeds to $</span>
<span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">seeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">seeds</span><span class="p">)</span>
    <span class="n">split_seeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">seeds</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">seeds</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">split_seeds</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Scatter the seeds among each MPI task</span>
<span class="n">rank_seeds</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">split_seeds</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1"># Create a array of zeros of the lenght of the MPI tasks seeds</span>
<span class="n">rank_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rank_seeds</span><span class="p">))</span>

<span class="c1"># For each number from 0 to the number of the MPI tasks, list of seeds and use</span>
<span class="c1"># one of those seeds to set the random seed (ensuring each random seed is</span>
<span class="c1"># different). Then create an array of random numbers with x and y equal to the</span>
<span class="c1"># matrix variable then calculate the dot product of the array with itself.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rank_seeds</span><span class="p">)):</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="n">rank_seeds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span><span class="n">matrix</span><span class="p">)</span>
    <span class="n">data_mm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">rank_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">data_mm</span><span class="p">))</span>
<span class="n">rank_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">rank_data</span><span class="p">)</span>

<span class="n">data_gather</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">rank_sum</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">data_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data_gather</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Gathered data:&#39;</span><span class="p">,</span> <span class="n">data_gather</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sum:&#39;</span><span class="p">,</span> <span class="n">data_sum</span><span class="p">)</span>
</code></pre></div>
<p>Now we need to write a Slurm script to run this job. The wall time,
number of logical CPU cores and amount of memory (RAM) you request for
this job will ideally be based on how this small-scale test runs on your
local workstation, but if that is not possible, make an educated guess,
and if the job fails increase the resources requested until is
completes.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you can, write your program so that it prints results and
timing information out relatively frequently, for example every 100 or
1,000 iterations. That way, even if your job runs out of time or memory
and gets killed, you will be able to see how far it got and how long it
took to get there.</p>
</div>
<h3 id="slurm-script">Slurm Script<a class="headerlink" href="#slurm-script" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>#!/bin/bash -e
#SBATCH --job-name=MPIScaling2
#SBATCH --ntasks=2
#SBATCH --time=00:30:00
#SBATCH --mem-per-cpu=512MB

module load Python
srun python MPIscaling.py
</code></pre></div>
<p>Let's run our Slurm script with sbatch and look at our output from
<code>sacct</code>.</p>
<div class="highlight"><pre><span></span><code>         JobID      JobName     Elapsed     TotalCPU Alloc   MaxRSS      State 
-------------- ------------ ----------- ------------ ----- -------- ----------
6057011        MPIScaling2     00:18:51     01:14:30     4          COMPLETED 
6057011.bat+   batch           00:18:51    00:00.607     4    4316K COMPLETED 
6057011.ext+   extern          00:18:52    00:00.001     4        0 COMPLETED 
6057011.0      python          00:18:46     01:14:30     2  166744K COMPLETED 
</code></pre></div>
<p>Our job performed 5,000 seeds using 2 physical CPU cores (each MPI task
will always receive 2 logical CPUs which is equal to 1 physical CPUs.
For a more in depth explanation about logical and physical CPU cores see
our <a href="../../../Scientific_Computing/Running_Jobs_on_Maui_and_Mahuika/Hyperthreading/">Hyperthreading article</a>)
and a maximum memory of 166,744KB (0.16 GB). In total, the job ran for
18 minutes and 51 seconds.</p>
<p>We will initially assume that our job's wall time and memory will scale
linearly with the number of iterations. However, we don't know that for
certain that this is the case so we will need to understand the scaling
behaviour of our job's resource requirements before we can submit our
full job and be confident it will succeed.</p>
<p>To find out we are going to have to run more tests. Let's try running
our script with 2, 3, 4, 5 and 6 MPI tasks/physical CPUs and plot the
results:</p>
<div class="highlight"><pre><span></span><code>         JobID      JobName     Elapsed     TotalCPU Alloc   MaxRSS      State 
-------------- ------------ ----------- ------------ ----- -------- ----------
6057011        MPIScaling2     00:18:51     01:14:30     4           COMPLETED 
6057011.bat+   batch           00:18:51    00:00.607     4    4316K  COMPLETED 
6057011.ext+   extern          00:18:52    00:00.001     4        0  COMPLETED 
6057011.0      python          00:18:46     01:14:30     2  166744K  COMPLETED
6054936        MPIScaling3     00:12:29     01:14:10     6           COMPLETED 
6054936.bat+   batch           00:12:29    00:00.512     2    4424K  COMPLETED 
6054936.ext+   extern          00:12:29    00:00.003     6        0  COMPLETED 
6054936.0      python          00:12:29     01:14:09     3  174948K  COMPLETED 
6054937        MPIScaling4     00:09:29     01:15:04     8           COMPLETED 
6054937.bat+   batch           00:09:29    00:00.658     2    4432K  COMPLETED 
6054937.ext+   extern          00:09:29    00:00.003     8        0  COMPLETED 
6054937.0      python          00:09:28     01:15:04     4  182064K  COMPLETED 
6054938        MPIScaling5     00:07:41     01:15:08    10           COMPLETED 
6054938.bat+   batch           00:07:41    00:00.679     2    4548K  COMPLETED 
6054938.ext+   extern          00:07:41    00:00.005    10        0  COMPLETED 
6054938.0      python          00:07:36     01:15:08     5  173632K  COMPLETED 
6054939        MPIScaling6     00:06:57     01:18:38    12           COMPLETED 
6054939.bat+   batch           00:06:57    00:00.609     2    4612K  COMPLETED 
6054939.ext+   extern          00:06:57    00:00.006    12      44K  COMPLETED 
6054939.0      python          00:06:51     01:18:37     6  174028K  COMPLETED 
</code></pre></div>
<p><img alt="MPIscalingMem.png" src="../../../assets/images/MPI_Scaling_Example.png" /></p>
<p>First, looking at the plot (we used R here, but feel free to use excel
or whatever your preferred plotting software) of memory usage per task
vs CPUs it would at appears that memory usage per task remains constant,
regardless of how many CPUs (equivalent to MPI tasks here) this job
uses, because this is an MPI job each task must have its own memory,
this is why, if we look back at the script we are using, that we request
memory per CPU, rather than just memory with <code>--mem</code>, since MPI jobs
will by their nature of having to read everything into memory once for
each task, have their memory scale (at least) linearly. But the results
of this plot means that we shouldn't have to worry about increasing the
memory per CPU.</p>
<p>One thing to note about our plot of CPUs versus memory is the fact that
memory usage is not measured continuously, it is instead measured every
30 seconds. This means that if your job's memory usage has some
spikes, <code>sacct</code> will not necessarily detect the maximum memory usage.
This is something that you should be aware of when you estimate the
memory usage of all your jobs.</p>
<p>Looking at the memory usage for an 8 CPU job, it looks like an 8 CPU has
a maximum memory requirement of 0.18 GB.</p>
<p><img alt="MPIscalingSeeds.png" src="../../../assets/images/MPI_Scaling_Example_0.png" width="47%" /> <img alt="MPIscalingSeedsLog.png" src="../../../assets/images/MPI_Scaling_Example_1.png" width="47%" /></p>
<p>The two above plots show the number of CPUs vs time and the Log2 of the
CPUs vs time.</p>
<p>The reason we have both is that it can often be easier to see the
inflection point on the Log2 graph when the speed up from increasing the
number of CPUs start to level off, as in the Log2 graph if the jobs
scaled perfectly linearly (e.g. doubling the CPU's halves the runtime)
the line would be straight. The curving of the line in the Log2 graph
represents a loss in efficiency from increasing the number of CPUs.</p>
<p>As we can see, increasing the number of CPU cores doesn't linearly
increase the job's speed.</p>
<p>This non-linear speed-up is mostly caused by Amdahl's Law, which
reflects the fact that there is a fixed part of the computation that is
inherently serial, that is, some operations can't be started until
others have already finished. Additionally, with MPI jobs, another major
component of this non-linear speed-up is caused by MPI communication
itself not being computationally free, what this means is that you can
get to a point where the computational cost of adding additional MPI
tasks is greater than the speed-up.</p>
<p>Looking at the plot of CPUs vs time we can see the asymptotic speedup
and this time the best number of CPUs to use for this job looks to be 5
physical CPUs.</p>
<p>Now that we have determined that 5 physical CPUs is the optimal number
of CPUs for our jobs we will use this as we will submit three more jobs,
using 10,000 15,000 and 20,000 seeds. </p>
<div class="highlight"><pre><span></span><code>         JobID      JobName     Elapsed     TotalCPU Alloc   MaxRSS      State 
-------------- ------------ ----------- ------------ ----- -------- ----------
6054938        MPIScaling5k    00:07:41     01:15:08    10           COMPLETED 
6054938.bat+   batch           00:07:41    00:00.679     2    4548K  COMPLETED 
6054938.ext+   extern          00:07:41    00:00.005    10        0  COMPLETED 
6054938.0      python          00:07:36     01:15:08     5  173632K  COMPLETED 
6059931        MPIScaling10k   00:14:57     02:27:36    10           COMPLETED 
6059931.bat+   batch           00:14:57    00:00.624    10    4320K  COMPLETED 
6059931.ext+   extern          00:14:57     00:00:00    10        0  COMPLETED 
6059931.0      python          00:14:56     02:27:36     5  170748K  COMPLETED 
6059939        MPIScaling15k   00:22:39     03:45:13    10           COMPLETED 
6059939.bat+   batch           00:22:39    00:00.631    10    4320K  COMPLETED 
6059939.ext+   extern          00:22:39     00:00:00    10        0  COMPLETED 
6059939.0      python          00:22:38     03:45:13     5  168836K  COMPLETED 
6059945        MPIScaling20k   00:30:34     05:02:42    10           COMPLETED 
6059945.bat+   batch           00:30:34    00:00.646    10    4320K  COMPLETED 
6059945.ext+   extern          00:30:34    00:00.001    10        0  COMPLETED 
6059945.0      python          00:30:32     05:02:41     5  172700K  COMPLETED 
</code></pre></div>
<p>We can see from the <code>sacct</code> output that the wall time seems to be
increasing as we add more seeds, but the maximum memory per CPU doesn't
seem to change much. Let's try plotting this data to help us better
understand what is happening:</p>
<p><img alt="MPIseedsvtime.png" src="../../../assets/images/MPI_Scaling_Example_2.png" /></p>
<p>This confirms our assumption of wall-time scaling linearly with number
of iterations. Since our 5,000 seed job to 7 minutes and 41 seconds we
can estimate that it will take about 12 times longer to run 60,000.</p>
<h2 id="estimating-our-total-resource-requirments">Estimating our Total Resource Requirments<a class="headerlink" href="#estimating-our-total-resource-requirments" title="Permanent link">&para;</a></h2>
<p>Now that we know approximately how our job's CPU, memory and wall time
requirements scale, we can try and estimate our total resource
requirements for our 60,000 iteration job.</p>
<p>From this data we have determined that more than 5 physical CPUs has
very limited additional speed up, and 5 CPU should use about 0.17 GB of
memory per task (CPU) at most, and that this memory requirement should
remain relatively consistent, regardless of the number of seeds. Given
this information we can estimate our full size job's resource
requirements. Since our 5 physical CPU, 5,000 iteration job took 17
minutes and 41 seconds, our full scale job should take 12 times longer
or about 5,532 seconds, 1 hour and 32 minutes (If you want to be more
exact you can take the mean of the walltime over the number of seeds, in
this case 0.09105, and multiply that by the number of seeds, which works
out to be 5,463 seconds, which is very close to our original estimate),
and require 0.17 GB of memory per task. To be on the safe side, let's
request 1 GB of memory and 2 hours.</p>
<h3 id="revised-slurm-script">Revised Slurm Script<a class="headerlink" href="#revised-slurm-script" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>#!/bin/bash -e
#SBATCH --account=nesi99999
#SBATCH --job-name=MPIScaling60k
#SBATCH --time=02:00:00
#SBATCH --mem-per-task=512MB
#SBATCH --ntasks=5

module load Python
srun python scaling.R
</code></pre></div>
<p>Checking on our job with <code>sacct</code></p>
<div class="highlight"><pre><span></span><code>         JobID      JobName     Elapsed     TotalCPU Alloc   MaxRSS      State 
-------------- ------------ ----------- ------------ ----- -------- ----------
6061377        MPIScaling60k   01:28:25     14:35:32    10           COMPLETED 
6061377.bat+   batch           01:28:25    00:00.555    10    4320K  COMPLETED 
6061377.ext+   extern          01:28:25     00:00:00    10        0  COMPLETED 
6061377.0      python          01:28:22     14:35:32     5  169060K  COMPLETED 
</code></pre></div>
<p>It looks as though our estimates were accurate in this case, however,
when you submit a job it is always a good idea to request about 20% more
wall time and memory than you think you are going to need to minimise
the chance of your jobs failing due to a lack of resources. Your
project's fair share score considers the time actually used by the job,
not the time requested by the job.</p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 19, 2024</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">July 21, 2021</span>
  </span>

    
    
    
  </aside>


  




                



              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
    <div id="new-footer">
        <div id="partners">
          <div id="logos">
            <a href="https://nesi.org.nz" class="nesi-footer-logo" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/LogoNeSI-footer.png"></a>
            <a href="http://www.mbie.govt.nz/" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/media/LogoMBIE.png"></a>
            <a href="https://www.auckland.ac.nz/" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/media/LogoUoA.png"></a>
            <a href="https://www.niwa.co.nz/" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/media/LogoNIWA.png"></a>
            <a href="https://www.otago.ac.nz/" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/media/LogoUoO.png"></a>
            <a href="http://www.landcareresearch.co.nz/" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/LogoManaakiWhenuaLandcareResearch.png"></a>
          </div>
        </div>
        <div id="inner">
          <span id="links"><a href="https://www.nesi.org.nz/copyright" target="_blank">Copyright © <span id="year">2023</span> · New Zealand eScience Infrastructure</a> | <a href="https://www.nesi.org.nz//disclaimer" target="_blank">Disclaimer</a> | <a href="https://www.nesi.org.nz//privacy" target="_blank">Privacy</a>
          </span>
        </div>
    </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.indexes", "navigation.top", "navigation.prune", "content.code.copy", "content.action.edit", "navigation.path"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.caa56a14.min.js"></script>
      
        <script src="../../../assets/javascripts/general.js"></script>
      
    
  </body>
</html>