
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="NeSI Support Documentation">
      
      
      
        <link rel="canonical" href="https://github.com/nesi/support-docs-concept/Scientific_Computing/HPC_Software_Environment/Compiling_software_on_Maui/">
      
      
        <link rel="prev" href="../Compiling_software_on_Mahuika/">
      
      
        <link rel="next" href="../Programming_environment_differences_between_Maui_and_Mahuika/">
      
      
      <link rel="icon" href="../../../assets/icons/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.7">
    
    
      
        <title>Compiling software: Māui - NeSI Support Center</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/neoteroi-mkdocs.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/footer.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/custom_admonations.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/theme.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-TVQR4R1F40"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-TVQR4R1F40",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-TVQR4R1F40",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-build-node" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
<style>
#banner{
    font-size: larger;
    text-align: center;
    background:  var(--md-warning-bg-color);
}
#banner a:link {
    color: blue;
}
#banner a:visited {
    color: purple;
}
#banner a:focus,
#banner a:hover {
    border-bottom: 1px solid;
}
#banner p{
    color: black;
}
</style>

<div id="banner">
    <p>This site is in Beta. All content is a duplication of  
    <a href="https://support.nesi.org.nz/hc/en-gb">offical NeSI support documentation.</a>
    </p>
</div>

      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="NeSI Support Center" class="md-header__button md-logo" aria-label="NeSI Support Center" data-md-component="logo">
      
  <img src="../../../assets/icons/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NeSI Support Center
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Compiling software: Māui
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/nesi/support-docs-concept" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    


    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="NeSI Support Center" class="md-nav__button md-logo" aria-label="NeSI Support Center" data-md-component="logo">
      
  <img src="../../../assets/icons/logo.svg" alt="logo">

    </a>
    NeSI Support Center
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nesi/support-docs-concept" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../Getting_Started/Accounts-Projects_and_Allocations/Creating_a_NeSI_Account_Profile/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../General/Announcements/Accessing_NeSI_Support_during_the_holiday_break/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    General
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Scientific Computing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Scientific Computing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Supported_Applications/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Supported Applications
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Training/Introduction_to_computing_on_the_NeSI_HPC/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Training
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Interactive_computing_using_Jupyter/Jupyter_on_NeSI/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Interactive computing using Jupyter
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../The_NeSI_High_Performance_Computers/Overview/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    The NeSI High Performance Computers
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Running_Jobs_on_Maui_and_Mahuika/Checking_your_projects_usage_using_nn_corehour_usage/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Running Jobs on Māui and Mahuika
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Profiling_and_Debugging/Debugging/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Profiling and Debugging
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" checked>
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    HPC Software Environment
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            HPC Software Environment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Build_an_Apptainer_container_on_a_Milan_compute_node/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Build an Apptainer container on a Milan compute node
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../OpenMP_settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenMP settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Offloading_to_GPU_with_OpenMP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Offloading to GPU with OpenMP 
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Offloading_to_GPU_with_OpenACC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Offloading to GPU with OpenACC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../NVIDIA_GPU_Containers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NVIDIA GPU Containers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Configuring_Dask_MPI_jobs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuring Dask-MPI jobs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Software_Version_Management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software Version Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Thread_Placement_and_Thread_Affinity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thread Placement and Thread Affinity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../NICE_DCV_Setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NICE DCV Setup
  </span>
  
    
  
  
    <span class="md-status md-status--deprecated"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Visualisation_software/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visualisation software
  </span>
  
    
  
  
    <span class="md-status md-status--deprecated"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Finding_Software/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Finding Software
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Installing_Third_Party_applications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing (Third Party) applications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Compiling_software_on_Mahuika/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compiling software: Mahuika
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Compiling software: Māui
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Compiling software: Māui
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-build-node" class="md-nav__link">
    <span class="md-ellipsis">
      The build node
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#choosing-a-programming-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing a programming environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#targeting-a-cpu" class="md-nav__link">
    <span class="md-ellipsis">
      Targeting a CPU
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-compiler-drivers" class="md-nav__link">
    <span class="md-ellipsis">
      Using the compiler drivers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compiling-and-running-mpi-code" class="md-nav__link">
    <span class="md-ellipsis">
      Compiling and Running MPI code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-compiler-options" class="md-nav__link">
    <span class="md-ellipsis">
      Common compiler options
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-code-that-depends-on-external-libraries" class="md-nav__link">
    <span class="md-ellipsis">
      Building Code that Depends on External Libraries
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-libraries-provided-by-cray" class="md-nav__link">
    <span class="md-ellipsis">
      Using libraries provided by Cray
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-libraries-provided-by-nesiniwa" class="md-nav__link">
    <span class="md-ellipsis">
      Using libraries provided by NeSI/NIWA
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-your-own-libraries" class="md-nav__link">
    <span class="md-ellipsis">
      Using your own libraries
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#static-and-dynamic-linking" class="md-nav__link">
    <span class="md-ellipsis">
      Static and dynamic linking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-linker-problems" class="md-nav__link">
    <span class="md-ellipsis">
      Common linker problems
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-code-on-the-cs500-platform" class="md-nav__link">
    <span class="md-ellipsis">
      Building code on the CS500 platform
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Programming_environment_differences_between_Maui_and_Mahuika/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Programming environment differences between Maui and Mahuika
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Per_job_temporary_directories/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Per job temporary directories
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Run_an_executable_under_Apptainer_in_parallel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run an executable under Apptainer in parallel
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Terminal_Setup/Standard_Terminal_Setup/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Terminal Setup
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Manuals_and_User_Guides/Manuals/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Manuals and User Guides
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../Storage/File_Systems_and_Quotas/NeSI_File_Systems_and_Quotas/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Storage
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-build-node" class="md-nav__link">
    <span class="md-ellipsis">
      The build node
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#choosing-a-programming-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing a programming environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#targeting-a-cpu" class="md-nav__link">
    <span class="md-ellipsis">
      Targeting a CPU
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-compiler-drivers" class="md-nav__link">
    <span class="md-ellipsis">
      Using the compiler drivers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compiling-and-running-mpi-code" class="md-nav__link">
    <span class="md-ellipsis">
      Compiling and Running MPI code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-compiler-options" class="md-nav__link">
    <span class="md-ellipsis">
      Common compiler options
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-code-that-depends-on-external-libraries" class="md-nav__link">
    <span class="md-ellipsis">
      Building Code that Depends on External Libraries
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-libraries-provided-by-cray" class="md-nav__link">
    <span class="md-ellipsis">
      Using libraries provided by Cray
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-libraries-provided-by-nesiniwa" class="md-nav__link">
    <span class="md-ellipsis">
      Using libraries provided by NeSI/NIWA
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-your-own-libraries" class="md-nav__link">
    <span class="md-ellipsis">
      Using your own libraries
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#static-and-dynamic-linking" class="md-nav__link">
    <span class="md-ellipsis">
      Static and dynamic linking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-linker-problems" class="md-nav__link">
    <span class="md-ellipsis">
      Common linker problems
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-code-on-the-cs500-platform" class="md-nav__link">
    <span class="md-ellipsis">
      Building code on the CS500 platform
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                

                  

  
    <a href="https://github.com/nesi/support-docs-concept/edit/main/docs/Scientific_Computing/HPC_Software_Environment/Compiling_software_on_Maui.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


  <h1>Compiling software: Māui</h1>

<p>Building Fortran, C, or C++ code on the XC50 platform requires using the Cray programming environment. From a user perspective, the programming environment consists of a set of environment modules that select a compiler, essential libraries such as the MPI library, a CPU target, and more. The build process on the XC50 thus differs slightly from a standard Linux system. Non-compiled code, such as Python or R programs, do not use the programming environment. Note, however, that loading a module provided by NeSI/NIWA to get access to, e.g., the “RegCM” code, may change the Cray programming environment in that Cray environment modules may be swapped.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul>
<li>It is essential to use a Programming Environment (PrgEnv-cray, PrgEnv-intel or PrgEnv-gnu) when you build code, otherwise it is likely that problems at build time or run time appear</li>
<li><strong>Never</strong> use <code>module purge</code> on the XC50 platform, this will render the programming environment unusable, and you will have to log out and log back in.</li>
<li>Code that was built on the XC50 platform is unlikely to run on Māui’s CS500 platform or on Mahuika’s CS400 platform;
please rebuild your code when you change platform.</li>
</ul>
</div>
<h2 id="the-build-node">The build node<a class="headerlink" href="#the-build-node" title="Permanent link">&para;</a></h2>
<p>Māui has a dedicated build node, <code>login.maui.nesi.org.nz</code>, which should be used for building code. Please do not build code on the compute nodes by submitting a build job through SLURM:</p>
<ul>
<li>The compute nodes only run a thin operating system with few command line utilities, it is thus likely that your build will fail.</li>
<li>The file system on XC50 compute nodes is optimised for handling large block IO, small block IO that is typical for a build job is inefficient.</li>
<li>Submitting a job will allocate entire nodes. This is a waste of compute resources, especially if only one core or a few cores are used.</li>
</ul>
<p>Please keep in mind that the build node is a shared resource. Instead of using as many parallel build processes as possible with <code>make -j &lt;n&gt;</code>, please limit the amount of processes (<code>make -j 5</code> for example).</p>
<h2 id="choosing-a-programming-environment">Choosing a programming environment<a class="headerlink" href="#choosing-a-programming-environment" title="Permanent link">&para;</a></h2>
<p>The following Programming Environments are provided on Māui, named after the underlying compiler suite:</p>
<ul>
<li><code>PrgEnv-cray</code></li>
<li><code>PrgEnv-intel</code></li>
<li><code>PrgEnv-gnu</code></li>
</ul>
<p>The <code>PrgEnv-cray</code> environment is the default. If you want to change programming environment to use the Intel or GNU compilers, run</p>
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>swap<span class="w"> </span>PrgEnv-cray<span class="w"> </span>PrgEnv-intel
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>swap<span class="w"> </span>PrgEnv-cray<span class="w"> </span>PrgEnv-gnu
</code></pre></div>
<p>Note that several compiler versions are currently installed, in case of GNU for example:</p>
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>avail<span class="w"> </span>gcc
</code></pre></div>
<div class="highlight"><pre><span></span><code>---------- /opt/modulefiles -----------
gcc/10.3.0 gcc/11.2.0 gcc/12.1.0(default)
</code></pre></div>
<p>To change GCC version, run for example</p>
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>swap<span class="w"> </span>gcc<span class="w"> </span>gcc/11.2.0
</code></pre></div>
<p>GCC v6.1.0 or later is required to build code that can make use of the Intel Skylake microarchitecture and its advanced capabilities, such as AVX-512, on the XC50 platform.
Note: There is not <strong>the</strong> best compiler. Depending on your application/algorithms, different compilers can optimise the code better. Keep in mind trying different compilers.</p>
<h2 id="targeting-a-cpu">Targeting a CPU<a class="headerlink" href="#targeting-a-cpu" title="Permanent link">&para;</a></h2>
<p>Compiling a program translates source code into machine instructions. It is important to let the compiler know for which CPU (“target”) the executable shall be build, to make best use of that CPU’s capabilities. Māui uses Intel Skylake microprocessors on all XC50 build and compute nodes, which come with AVX-512 vector instructions, enabling better performance for some codes.
CPU targets can be set by loading a module. By default, module <code>craype-x86-skylake</code> is loaded. In the rare case that you encounter problems with the Skylake target at build time or run time, try target for “Broadwell” processors instead:</p>
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>swap<span class="w"> </span>craype-x86-skylake<span class="w"> </span>craype-broadwell
</code></pre></div>
<p>Choosing the “Broadwell” target is also necessary if you want to build code using the older GCC compilers prior to GCC 6.1.0, which were released before Skylake became available. If you see the error message</p>
<div class="highlight"><pre><span></span><code>craype-x86-skylake requires cce/8.6 or later, intel/15.1 or later, or gcc/6.1 or later\
</code></pre></div>
<p>when trying to swap to the `PrgEnv-gnu`` environment, or an error message of the kind</p>
<div class="highlight"><pre><span></span><code>f951: error: bad value (skylake-avx512) for -march= switch
</code></pre></div>
<p>when you compile a program with a GNU compiler, run</p>
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>swap<span class="w"> </span>craype-x86-skylake<span class="w"> </span>craype-broadwell
</code></pre></div>
<p>and try again.
Make sure that a target is always set. If you do not set a target, the compilers will produce generic code that runs on many processors of the “x86-64” family, and the program will thus not be able to benefit from capabilities such as AVX-512. You will see the following warning message when you run a compiler:</p>
<div class="highlight"><pre><span></span><code>No supported cpu target is set, CRAY_CPU_TARGET=x86-64 will be used.
Load a valid targeting module or set CRAY_CPU_TARGET
</code></pre></div>
<h2 id="using-the-compiler-drivers">Using the compiler drivers<a class="headerlink" href="#using-the-compiler-drivers" title="Permanent link">&para;</a></h2>
<p>The programming environment provides compiler drivers for compiling Fortran, C, and C++ code. This means that you will need to use the following commands instead of the actual compilers:</p>
<div class="highlight"><pre><span></span><code>ftn<span class="w"> </span>-o<span class="w"> </span>simpleMpi<span class="w"> </span>simpleMpi.f90<span class="w"> </span><span class="c1"># compile Fortran code</span>
cc<span class="w">  </span>-o<span class="w"> </span>simpleMpi<span class="w"> </span>simpleMpi.c<span class="w">    </span><span class="c1"># compile C code</span>
CC<span class="w">  </span>-o<span class="w"> </span>simpleMpi<span class="w"> </span>simpleMpi.cxx<span class="w">  </span><span class="c1"># compile C++ code</span>
</code></pre></div>
<p>The drivers will ensure correct linking of your code with compiler runtime libraries, and with Cray-supported libraries (such as Cray’s “libsci” scientific library, or Cray’s version of netCDF). It is therefore not recommended to use the compilers directly, there is a good chance that the executable will fail to build or run correctly.
The compiler drivers automatically add necessary compile and link flags to the compile/link line for the selected hardware and Cray-supported libraries. If you are interested in seeing what the compiler driver does, add the <code>-craype-verbose</code> flag:</p>
<div class="highlight"><pre><span></span><code>ftn<span class="w"> </span>-craype-verbose<span class="w"> </span>-o<span class="w"> </span>simpleMpi<span class="w"> </span>simpleMpi.f90
</code></pre></div>
<h2 id="compiling-and-running-mpi-code">Compiling and Running MPI code<a class="headerlink" href="#compiling-and-running-mpi-code" title="Permanent link">&para;</a></h2>
<p>The compiler drivers will also automatically build MPI codes correctly, there is no need to use special compilers or add additional compiler or linker flags.
Note that running an MPI code on the build node (<code>login.maui.nesi.org.nz</code>) using</p>
<div class="highlight"><pre><span></span><code>./simpleMPI
</code></pre></div>
<p>will fail with an error message, as there is no MPI runtime environment:</p>
<div class="highlight"><pre><span></span><code>[Wed Oct 18 02:00:14 2017] [c0-0c0s3n1] Fatal error in MPI_Init: Other MPI error, error stack:

MPIR_Init_thread(537):
MPID_Init(247).......: channel initialization failed
MPID_Init(636).......:  PMI2 init failed: 1
</code></pre></div>
<p>If you want to run a short test of your build, use SLURM’s srun command that submits your program to a compute node on the fly, e.g.,</p>
<div class="highlight"><pre><span></span><code>SLURM_PARTITION=nesi_research srun -n 6 simpleMPI
</code></pre></div>
<h2 id="common-compiler-options">Common compiler options<a class="headerlink" href="#common-compiler-options" title="Permanent link">&para;</a></h2>
<p>Although the compiler drivers <code>ftn</code>, <code>cc</code> and <code>CC</code> have a few options of their own, such as the <code>-craype-verbose</code> flag, they will pass through any additional compiler options to the underlying compiler. This means that you will still need to choose compiler flags that are specific to the Cray, Intel, or GNU compilers, and you will need to change them if you decide to switch compilers.</p>
<p>For example, if you wanted to use the GFortran compiler, activate compiler warnings (<code>-Wall</code>), and require aggressive compiler optimisation (<code>-O3</code>), you would use the following commands:</p>
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>swap<span class="w"> </span>PrgEnv-cray<span class="w"> </span>PrgEnv-gnu
ftn<span class="w"> </span>-Wall<span class="w"> </span>-O3<span class="w"> </span>-o<span class="w"> </span>simpleMpi<span class="w"> </span>simpleMpi.f90
</code></pre></div>
<p>The following table provides a list of commonly used compiler options:</p>
<table>
<thead>
<tr>
<th>Group</th>
<th>Cray</th>
<th>Intel</th>
<th>GNU</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Debugging</td>
<td><code>-g</code> or <code>-G{0,1,2,fast}</code></td>
<td><code>-g</code> or <code>-debug [keyword]</code></td>
<td><code>-g</code> or <code>-g{0,1,2,3}</code></td>
<td>Set level of debugging information, some levels may disable certain compiler optimisations</td>
</tr>
<tr>
<td>Light compiler optimisation</td>
<td><code>-O2</code></td>
<td><code>-O2</code></td>
<td><code>-O2</code></td>
<td></td>
</tr>
<tr>
<td>Aggressive compiler optimisation</td>
<td><code>-O3 -hfp3</code></td>
<td><code>-O3 -ipo</code></td>
<td><code>-O3 -ffast-math -funroll-loops</code></td>
<td>This may affect numerical accuracy.</td>
</tr>
<tr>
<td>Vectorisation reports</td>
<td><code>-hlist=m</code></td>
<td><code>-qopt-report</code></td>
<td><code>-fopt-info-vec</code> or <code>-fopt-info-missed</code></td>
<td></td>
</tr>
<tr>
<td>OpenMP</td>
<td><code>-homp</code> (default)</td>
<td><code>-openmp</code></td>
<td><code>-fopenmp</code></td>
<td></td>
</tr>
</tbody>
</table>
<p>Additional compiler options are documented on the compiler man pages, which are accessible <em>after</em> loading the corresponding programming environment:</p>
<table>
<thead>
<tr>
<th>language</th>
<th>cray</th>
<th>intel</th>
<th>gnu</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fortran</td>
<td><code>man crayftn</code></td>
<td><code>man ifort</code></td>
<td><code>man gfortran</code></td>
</tr>
<tr>
<td>C</td>
<td><code>man craycc</code></td>
<td><code>man icc</code></td>
<td><code>man gcc</code></td>
</tr>
<tr>
<td>C++</td>
<td><code>man crayCC</code></td>
<td><code>man icpc</code></td>
<td><code>man g++</code></td>
</tr>
</tbody>
</table>
<h2 id="building-code-that-depends-on-external-libraries">Building Code that Depends on External Libraries<a class="headerlink" href="#building-code-that-depends-on-external-libraries" title="Permanent link">&para;</a></h2>
<p>While linking external libraries, one need to pay attention to the correct compiler and linker setup. This, depends on the correct library version (working properly with the compiler and the link type) and the used link options. These depend on whether the libraries have been provided by Cray, by NeSI/NIWA, or if you built them yourself.</p>
<p>Many libraries are provided in modules. You can search them using</p>
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>avail
</code></pre></div>
<p>and look in the module description using:</p>
<div class="highlight"><pre><span></span><code>module<span class="w"> </span><span class="nb">help</span><span class="w"> </span>&lt;module-name&gt;
</code></pre></div>
<p>Sometimes modules provide multiple libraries, e.g. <code>cray-libsci</code></p>
<h2 id="using-libraries-provided-by-cray">Using libraries provided by Cray<a class="headerlink" href="#using-libraries-provided-by-cray" title="Permanent link">&para;</a></h2>
<p>If a library has been provided by Cray, the compiler drivers will automatically take care of adding search paths for include files and libraries, and they will add the library names to the linker line. For example, to build a program that uses the netCDF library provided by the <code>cray-netcdf</code> module, run the commands</p>
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>load<span class="w"> </span>cray-netcdf
ftn<span class="w"> </span>-o<span class="w"> </span>simple_xy_wr<span class="w"> </span>simple_xy_wr.f90
</code></pre></div>
<p>Keep in mind that such automatic treatment of dependencies will <strong>only</strong> work if the libraries have been provided by Cray - you can recognise those by their module name, which always starts with <code>cray-</code>, e.g., <code>cray-netcdf</code>, or <code>cray-libsci</code>.
Note also that correct versions of the libraries (Cray CCE, Intel, or GNU builds) will automatically be used after swapping programming environment. This is particularly important for libraries that provide Fortran 90 modules, due to their compiler-specific format.</p>
<h2 id="using-libraries-provided-by-nesiniwa">Using libraries provided by NeSI/NIWA<a class="headerlink" href="#using-libraries-provided-by-nesiniwa" title="Permanent link">&para;</a></h2>
<p>The situation is different when you use a library that is provided by NeSI/NIWA. They can be recognised by the <code>CrayCCE</code>, <code>CrayIntel</code>, or <code>CrayGNU</code> suffix attached to their version number. In this case, you will have to provide search paths using the <code>-I</code> flag for include files, and <code>-L</code> for library files, and the library names have to be explicitly added to the linker line. Libraries are not always provided for all compiler suites and versions.
Note that library names are specified in a specifically formatted form, <code>-l&amp;lt;library name&amp;gt;</code>. The linker then expects to find a library file named <code>lib&amp;lt;library name&amp;gt;.a</code> (for a static library) or <code>lib&amp;lt;library name&amp;gt;.so</code> (for a shared library), e.g., <code>libnetcdf.a</code>. Note that you may need to list several libraries to link successfully, e.g., <code>-lA -lB</code> for linking against libraries “A” and “B”. The order in which you list libraries matters, as the linker will go through the list in order of appearance. If library “A” depends on library “B”, specifying <code>-lA -lB</code> will work. If library “B” depends on “A”, use <code>-lB -lA</code>. If they depend on each other, use <code>-lA -lB -lA</code> (although such cases are quite rare).
Consider the following example where the <code>grib_api</code> library is used:</p>
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>load<span class="w"> </span>grib_api/1.23.1-CrayGNU-18.08
cc<span class="w"> </span>-I<span class="nv">$EBROOTGRIB_API</span>/include<span class="w"> </span>-o<span class="w"> </span>mygribprogram<span class="w"> </span>mygribprogram.c<span class="w"> </span>-L<span class="nv">$EBROOTGRIB_API</span>/lib<span class="w"> </span>-lgrib_api
</code></pre></div>
<p>The EasyBuild software management system that NeSI/NIWA use to provide modules automatically defines environment variables <code>$EBROOT&amp;lt;library name in upper case&amp;gt;</code> when a module is loaded, which help pointing the compiler and linker to include files and libraries as in the example above. If you are unsure which <code>$EBROOT&amp;lt;...&amp;gt;</code> variables are available, use</p>
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>show<span class="w"> </span>grib_api/1.23.1-CrayGNU-18.08
</code></pre></div>
<p>to find out.
Note that specifying search paths with <code>-I</code> and <code>-L</code> is not strictly necessary in case of the GNU and Intel compilers, which will use the contents of <code>CPATH</code>, <code>LIRARY_PATH</code>, and <code>LD_LIBRARY_PATH</code> provided by the NeSI/NIWA module. This will not work with the Cray compiler.
<strong>Important note:</strong> Make sure that you load the correct variant ofXC50 a library, depending on your choice of compiler. Switching compiler environment will <em>not</em> switch NeSI/NIWA modules automatically. Furthermore, loading a NeSI/NIWA module may switch programming environment if it was built with a different compiler.
As mentioned earlier, EasyBuild uses the following module naming conventions (“toolchain names”) to identify the programming environment that was used to build the software:</p>
<ul>
<li><code>CrayCCE</code> for libraries and tools built with the Cray compilers (<code>PrgEnv-cray</code>).</li>
<li><code>CrayIntel</code> for libraries and tools built with the Intel compilers (<code>PrgEnv-intel</code>).</li>
<li><code>CrayGNU</code> for libraries and tools built with the GNU compilers (<code>PrgEnv-gnu</code>).</li>
</ul>
<h2 id="using-your-own-libraries">Using your own libraries<a class="headerlink" href="#using-your-own-libraries" title="Permanent link">&para;</a></h2>
<p>Linking against libraries that you built yourself is the same as linking against libraries provided by NeSI/NIWA - you will just need to point the compiler to the location where the include and library files are using the <code>-I</code> and <code>-L</code> flags.</p>
<h2 id="static-and-dynamic-linking">Static and dynamic linking<a class="headerlink" href="#static-and-dynamic-linking" title="Permanent link">&para;</a></h2>
<p>The XC50 compilers drivers default to static linking where possible for maximum efficiency, avoiding the need to load shared libraries for hundreds or thousands of MPI ranks at runtime. If all dependencies are available as static libraries, the resulting executables will be completely self-contained (although they may still need the Cray MPI environment at runtime).
Here is an example that shows how to find out how your code was linked:</p>
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>load<span class="w"> </span>GSL/2.4-CrayGNU-2017.06
cc<span class="w"> </span>-I<span class="nv">$EBROOTGRIB_API</span>/include<span class="w"> </span>-o<span class="w"> </span>mygribprogram<span class="w"> </span>mygribprogram.c<span class="w"> </span>-L<span class="nv">$EBROOTGRIB_API</span>/lib<span class="w"> </span>-lgrib_api
ldd<span class="w"> </span>mygribprogram
</code></pre></div>
<p>If you see the message <code>not a dynamic executable</code>, your program was statically linked. Otherwise you will see a list of shared library dependencies that are needed at runtime.
If you have to link your code dynamically, either set</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">CRAYPE_LINK_TYPE</span><span class="o">=</span>dynamic
</code></pre></div>
<p>in your build environment (useful when using complex build systems), or add the <code>-dynamic</code> flag to the compiler driver commands, e.g.,</p>
<div class="highlight"><pre><span></span><code>cc<span class="w"> </span>-I<span class="nv">$EBROOTGRIB_API</span>/include<span class="w"> </span>-o<span class="w"> </span>mygribprogram<span class="w"> </span>mygribprogram.c<span class="w"> </span>-L<span class="nv">$EBROOTGRIB_API</span>/lib<span class="w"> </span>-lgrib_api<span class="w"> </span>-dynamic
</code></pre></div>
<p>Using the <code>ldd</code> tool, you should now see a number of libraries that are dynamically linked.
You may occassionally see a warning message of the kind:</p>
<div class="highlight"><pre><span></span><code>/opt/cray/pe/hdf5/1.10.1.1/INTEL/16.0/lib/libhdf5.a(H5PL.o): In function `H5PL_load&#39;:
H5PL.c:(.text+0x612): warning: Using &#39;dlopen&#39; in statically linked applications requires at runtime the shared libraries from the glibc version used for linking
</code></pre></div>
<p>This simply means that the library must be accessible at runtime despite fully static linking and the program is thus not entirely self-contained, which is usually not an issue.</p>
<h2 id="common-linker-problems">Common linker problems<a class="headerlink" href="#common-linker-problems" title="Permanent link">&para;</a></h2>
<p>Linking can easily go wrong. Most often, you will see linker errors about “missing symbols” when the linker could not find a function used in your program or in one of the libraries that you linked against. To resolve this problem, have a closer look at the function names that the linker reported:</p>
<ul>
<li>Are you missing some object code files (these are compiled source files and have suffix <code>.o</code>) that should appear on the linker line? This can happen if the build system was not configured correctly or has a bug. Try running the linking step manually with all source files and debug the build system (which can be a lengthy and cumbersome process, unfortunately).</li>
<li>Do the missing functions have names that contain “mp” or “omp”? This could mean that some of your source files or external libraries were built with OpenMP support, which requires you to set an OpenMP flag (<code>-fopenmp</code> for GNU compilers, <code>-qopenmp</code> for Intel) in your linker command. For the Cray compilers, OpenMP is enabled by default and can be controlled using <code>-h[no]omp</code>.</li>
<li>Do you see a very long list of complex-looking function names, and does your source code or external library dependency include C++ code? You may need to explicitly link against the C++ standard library (<code>-lstdc++</code> for GNU and Cray compilers, <code>-cxxlib</code> for Intel compilers); this is a particularly common problem for statically linked code.</li>
<li>Do the function names end with an underscore (“_”)? You might be missing some Fortran code, either from your own sources or from a library that was written in Fortran, or parts of your Fortran code were built with flags such as <code>-assume nounderscore</code> (Intel) or <code>-fno-underscoring</code> (GNU), while others were using different flags (note that the Cray compiler always uses underscores).</li>
<li>Do the function names end with double underscores (“__”)? Fortran compilers offer an option to add double underscores to Fortran subroutine names for compatibility reasons (<code>-h [no]second_underscore</code>, <code>-assume [no]2underscores</code>, <code>-f[no-]second-underscore</code>) which you may have to add or remove.</li>
</ul>
<p>Note that the linker requires that function names match exactly, so any variation in function name in your code will lead to a “missing symbols” error (with the exception of character case in Fortran source code).</p>
<h2 id="building-code-on-the-cs500-platform">Building code on the CS500 platform<a class="headerlink" href="#building-code-on-the-cs500-platform" title="Permanent link">&para;</a></h2>
<p>Building code on the CS500 platform is different from the XC50 platform:</p>
<ul>
<li>The CS500 platform does not currently use compiler drivers (these will be made available by Cray in the near future).</li>
<li>The CS500 module environment can be reset using <code>module purge</code> without problems - you will need to run <code>module load NeSI</code> afterwards to make the NeSI software stack available again.</li>
</ul>
<p>Building code on the CS500 platform follows the same process as building code on Mahuika. The only difference is that CS500 nodes use Intel Skylake CPUs, while Mahuika’s CS400 nodes use the older Intel Broadwell CPUs. This means that programs that were compiled on the CS500 platform may fail to run on Mahuika, producing either an error message (if built with the Intel compiler), or an “illegal instruction” error (if built with the Cray or GNU compilers).
Please refer to section <a href="../Compiling_software_on_Mahuika/">Compiling Software: Mahuika</a> for further instructions.</p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 31, 2024</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">July 21, 2021</span>
  </span>

    
    
    
  </aside>


  




                



              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
    <div id="new-footer">
        <div id="partners">
          <div id="logos">
            <a href="https://nesi.org.nz" class="nesi-footer-logo" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/LogoNeSI-footer.png"></a>
            <a href="http://www.mbie.govt.nz/" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/media/LogoMBIE.png"></a>
            <a href="https://www.auckland.ac.nz/" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/media/LogoUoA.png"></a>
            <a href="https://www.niwa.co.nz/" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/media/LogoNIWA.png"></a>
            <a href="https://www.otago.ac.nz/" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/media/LogoUoO.png"></a>
            <a href="http://www.landcareresearch.co.nz/" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/LogoManaakiWhenuaLandcareResearch.png"></a>
          </div>
        </div>
        <div id="inner">
          <span id="links"><a href="https://www.nesi.org.nz/copyright" target="_blank">Copyright © <span id="year">2023</span> · New Zealand eScience Infrastructure</a> | <a href="https://www.nesi.org.nz//disclaimer" target="_blank">Disclaimer</a> | <a href="https://www.nesi.org.nz//privacy" target="_blank">Privacy</a>
          </span>
        </div>
    </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.indexes", "navigation.top", "navigation.prune", "content.code.copy", "content.action.edit", "navigation.path"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.caa56a14.min.js"></script>
      
        <script src="../../../assets/javascripts/general.js"></script>
      
    
  </body>
</html>