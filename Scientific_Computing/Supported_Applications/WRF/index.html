
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="NeSI Support Documentation">
      
      
      
        <link rel="canonical" href="https://github.com/nesi/support-docs-concept/Scientific_Computing/Supported_Applications/WRF/">
      
      
        <link rel="prev" href="../Lambda%20Stack/">
      
      
        <link rel="next" href="../CESM/">
      
      
      <link rel="icon" href="../../../assets/icons/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.4">
    
    
      
        <title>WRF - NeSI Support Center</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/neoteroi-mkdocs.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/footer.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/custom_admonations.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/theme.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#wrf-on-mahuika" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
<style>
#banner{
    font-size: larger;
    text-align: center;
    background:  var(--md-warning-bg-color);
}
#banner a:link {
    color: blue;
}
#banner a:visited {
    color: purple;
}
#banner a:focus,
#banner a:hover {
    border-bottom: 1px solid;
}
#banner p{
    color: black;
}
</style>

<div id="banner">
    <p>This site is in Beta. All content is a duplication of  
    <a href="https://support.nesi.org.nz/hc/en-gb">offical NeSI support documentation.</a>
    </p>
</div>

      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="NeSI Support Center" class="md-header__button md-logo" aria-label="NeSI Support Center" data-md-component="logo">
      
  <img src="../../../assets/icons/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NeSI Support Center
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              WRF
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/nesi/support-docs-concept" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    


    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="NeSI Support Center" class="md-nav__button md-logo" aria-label="NeSI Support Center" data-md-component="logo">
      
  <img src="../../../assets/icons/logo.svg" alt="logo">

    </a>
    NeSI Support Center
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nesi/support-docs-concept" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../Getting_Started/Accessing_the_HPCs/Setting_Up_and_Resetting_Your_Password/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../General/Announcements/Accessing_NeSI_Support_during_the_holiday_break/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    General
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Scientific Computing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Scientific Computing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../HPC_Software_Environment/Build_an_Apptainer_container_on_a_Milan_compute_node/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    HPC Software Environment
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Interactive_computing_using_Jupyter/Jupyter_on_NeSI/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Interactive computing using Jupyter
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Manuals_and_User_Guides/Troubleshooting_on_NeSI/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Manuals and User Guides
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Profiling_and_Debugging/Debugging/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Profiling and Debugging
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Release_Notes_jupyter-nesi-org-nz/jupyter-nesi-org-nz_release_notes_02-02-2023/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Release Notes jupyter nesi org nz
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Running_Jobs_on_Maui_and_Mahuika/Checking_your_projects_usage_using_nn_corehour_usage/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Running Jobs on Maui and Mahuika
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Supported Applications
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Supported Applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../BRAKER/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BRAKER
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Dorado/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dorado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../snpEff/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    snpEff
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GATK/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GATK
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ipyrad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ipyrad
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Clair3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Clair3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Cylc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cylc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ont-guppy-gpu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ont-guppy-gpu
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AlphaFold/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AlphaFold
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../VirSorter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VirSorter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Lambda%20Stack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lambda Stack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    WRF
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    WRF
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#wrf-on-mahuika" class="md-nav__link">
    <span class="md-ellipsis">
      WRF on Mahuika
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WRF on Mahuika">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-on-mahuika" class="md-nav__link">
    <span class="md-ellipsis">
      Environment on Mahuika
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-wrf-dependencies-on-mahuika" class="md-nav__link">
    <span class="md-ellipsis">
      Building WRF dependencies on Mahuika
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-wrf-on-mahuika" class="md-nav__link">
    <span class="md-ellipsis">
      Running WRF on Mahuika
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrf-on-maui" class="md-nav__link">
    <span class="md-ellipsis">
      WRF on Māui
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WRF on Māui">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-wrf" class="md-nav__link">
    <span class="md-ellipsis">
      Building WRF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-wrf" class="md-nav__link">
    <span class="md-ellipsis">
      Running WRF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-wps" class="md-nav__link">
    <span class="md-ellipsis">
      Building WPS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-wps" class="md-nav__link">
    <span class="md-ellipsis">
      Running WPS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CESM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CESM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Delft3D/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delft3D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Miniconda3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Miniconda3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MAKER/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MAKER
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../VTune/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VTune
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ABAQUS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ABAQUS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ANSYS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ANSYS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../BLAST/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BLAST
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../COMSOL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    COMSOL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../FDS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FDS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Gaussian/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gaussian
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GROMACS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GROMACS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Julia/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Julia
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../JupyterLab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JupyterLab
  </span>
  
    
  
  
    <span class="md-status md-status--deprecated"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Keras/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Keras
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MATLAB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MATLAB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../OpenFOAM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenFOAM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ORCA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ORCA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../OpenSees/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenSees
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ParaView/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ParaView
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../R/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    R
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RAxML/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RAxML
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Relion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Relion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Singularity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Singularity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Supernova/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Supernova
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Software%20Installation%20Request/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software Installation Request
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Synda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Synda
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../TensorFlow_on_GPUs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TensorFlow on GPUs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../TensorFlow_on_CPUs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TensorFlow on CPUs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Trinity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trinity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../TurboVNC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TurboVNC
  </span>
  
    
  
  
    <span class="md-status md-status--deprecated"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../VASP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VASP
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Terminal_Setup/Standard_Terminal_Setup/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Terminal Setup
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../The_NeSI_High_Performance_Computers/Overview/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    The NeSI High Performance Computers
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Training/Introduction_to_computing_on_the_NeSI_HPC/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Training
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../Storage/Data_Recovery/File_Recovery/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Storage
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../NeSI_Service_Subscriptions/Contracts_and_billing_processes/Types_of_contracts/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    NeSI Service Subscriptions
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#wrf-on-mahuika" class="md-nav__link">
    <span class="md-ellipsis">
      WRF on Mahuika
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WRF on Mahuika">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-on-mahuika" class="md-nav__link">
    <span class="md-ellipsis">
      Environment on Mahuika
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-wrf-dependencies-on-mahuika" class="md-nav__link">
    <span class="md-ellipsis">
      Building WRF dependencies on Mahuika
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-wrf-on-mahuika" class="md-nav__link">
    <span class="md-ellipsis">
      Running WRF on Mahuika
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrf-on-maui" class="md-nav__link">
    <span class="md-ellipsis">
      WRF on Māui
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WRF on Māui">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-wrf" class="md-nav__link">
    <span class="md-ellipsis">
      Building WRF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-wrf" class="md-nav__link">
    <span class="md-ellipsis">
      Running WRF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-wps" class="md-nav__link">
    <span class="md-ellipsis">
      Building WPS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-wps" class="md-nav__link">
    <span class="md-ellipsis">
      Running WPS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                

                  

  
    <a href="https://github.com/nesi/support-docs-concept/edit/main/docs/Scientific_Computing/Supported_Applications/WRF.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


  <h1>WRF</h1>

<p>The Weather Research and Forecasting (WRF) Model is a next-generation
mesoscale numerical weather prediction system designed for both
atmospheric research and operational forecasting applications. It
features two dynamical cores, a data assimilation system, and a software
architecture supporting parallel computation and system extensibility.
The model serves a wide range of meteorological applications across
scales from tens of meters to thousands of kilometres.</p>
<p>Download WRF:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/nesi/project/&lt;your_project_code&gt;
wget<span class="w"> </span>https://github.com/wrf-model/WRF/archive/v4.1.1.tar.gz
tar<span class="w"> </span>xf<span class="w"> </span>v4.1.1.tar.gz
</code></pre></div>
<p>This guide is based on WRF 4.1.1 and WPS 4.2 (it was also tested with
Polar WRF 4.1.1 but for that, you would need to apply the Polar WRF and
WPS patches before compiling).</p>
<p>WRF needs NetCDF, NetCDF-Fortran, PnetCDF and their dependencies to be
installed. On Māui, these are available as modules. On Mahuika, we
recommend to download these packages and build them by hand
(instructions are provided below).</p>
<h2 id="wrf-on-mahuika">WRF on Mahuika<a class="headerlink" href="#wrf-on-mahuika" title="Permanent link">&para;</a></h2>
<h3 id="environment-on-mahuika">Environment on Mahuika<a class="headerlink" href="#environment-on-mahuika" title="Permanent link">&para;</a></h3>
<p>We'll use the Intel compiler and Intel MPI library.</p>
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>purge
module<span class="w"> </span>load<span class="w"> </span>HDF5/1.12.2-iimpi-2022a
</code></pre></div>
<p>Although NeSI has NetCDF modules installed, WRF wants the C and Fortran
NetCDF libraries, include files and modules all installed under the same
root directory. Hence we build those by hand.</p>
<h3 id="building-wrf-dependencies-on-mahuika">Building WRF dependencies on Mahuika<a class="headerlink" href="#building-wrf-dependencies-on-mahuika" title="Permanent link">&para;</a></h3>
<p>Copy-paste the commands below to build WRF on Mahuika:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># create build directory for WRF&#39;s dependencies</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">WRF_DEPS_DIR</span><span class="o">=</span><span class="nv">$PWD</span>/wrf-deps
mkdir<span class="w"> </span><span class="nv">$WRF_DEPS_DIR</span>
<span class="nb">cd</span><span class="w"> </span><span class="nv">$WRF_DEPS_DIR</span>

<span class="c1"># required for building and running</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$WRF_DEPS_DIR</span>/lib:<span class="nv">$LD_LIBRARY_PATH</span>

<span class="c1"># to access the nc-config anf nf-config commands</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$WRF_DEPS_DIR</span>/bin:<span class="nv">$PATH</span>

<span class="c1"># set the compilers</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">CC</span><span class="o">=</span>icc
<span class="nb">export</span><span class="w"> </span><span class="nv">CXX</span><span class="o">=</span>icc
<span class="nb">export</span><span class="w"> </span><span class="nv">FC</span><span class="o">=</span>ifort
<span class="nb">export</span><span class="w"> </span><span class="nv">F77</span><span class="o">=</span>ifort
<span class="nb">export</span><span class="w"> </span><span class="nv">MPICC</span><span class="o">=</span>mpiicc
<span class="nb">export</span><span class="w"> </span><span class="nv">MPICXX</span><span class="o">=</span>mpiicc
<span class="nb">export</span><span class="w"> </span><span class="nv">MPIF77</span><span class="o">=</span>mpiifort
<span class="nb">export</span><span class="w"> </span><span class="nv">MPIF90</span><span class="o">=</span>mpiifort

<span class="c1"># now install the dependencies</span>

<span class="c1"># netcdf-c</span>
wget<span class="w"> </span>https://downloads.unidata.ucar.edu/netcdf-c/4.9.2/netcdf-c-4.9.2.tar.gz
tar<span class="w"> </span>xf<span class="w"> </span>netcdf-c-4.9.2.tar.gz
<span class="nb">cd</span><span class="w"> </span>netcdf-c-4.9.2/
./configure<span class="w"> </span>--prefix<span class="o">=</span><span class="nv">$WRF_DEPS_DIR</span>
make<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>make<span class="w"> </span>install
<span class="nb">cd</span><span class="w"> </span>..

<span class="c1"># netcdf-fortran</span>
wget<span class="w"> </span>https://downloads.unidata.ucar.edu/netcdf-fortran/4.6.1/netcdf-fortran-4.6.1.tar.gz
tar<span class="w"> </span>xf<span class="w"> </span>netcdf-fortran-4.6.1.tar.gz
<span class="nb">cd</span><span class="w"> </span>netcdf-fortran-4.6.1
<span class="nv">CPPFLAGS</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>../bin/nc-config<span class="w"> </span>--cflags<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>../bin/nc-config<span class="w"> </span>--libs<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
./configure<span class="w"> </span>--prefix<span class="o">=</span><span class="nv">$WRF_DEPS_DIR</span>
make<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>make<span class="w"> </span>install
<span class="nb">cd</span><span class="w"> </span>..

<span class="c1"># pnetcdf</span>
wget<span class="w"> </span>https://parallel-netcdf.github.io/Release/pnetcdf-1.12.3.tar.gz
tar<span class="w"> </span>xf<span class="w"> </span>pnetcdf-1.12.3.tar.gz
<span class="nb">cd</span><span class="w"> </span>pnetcdf-1.12.3
./configure<span class="w"> </span>--prefix<span class="o">=</span><span class="nv">$WRF_DEPS_DIR</span><span class="w"> </span>--with-netcdf4<span class="o">=</span><span class="nv">$WRF_DEPS_DIR</span>
make<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>make<span class="w"> </span>install
<span class="nb">cd</span><span class="w"> </span>..

<span class="c1"># back to the top directory</span>
<span class="nb">cd</span><span class="w"> </span>..
</code></pre></div>
<p>Then proceed to configure WRF by setting</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">NETCDF</span><span class="o">=</span><span class="nv">$WRF_DEPS_DIR</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">HDF5</span><span class="o">=</span><span class="nv">$WRF_DEPS_DIR</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PNETCDF</span><span class="o">=</span><span class="nv">$WRF_DEPS_DIR</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>WRF-4.1.1
./configure
<span class="o">[</span><span class="k">select</span><span class="w"> </span><span class="m">15</span><span class="o">]</span>
</code></pre></div>
<p>and build the code with</p>
<div class="highlight"><pre><span></span><code>./compile<span class="w"> </span>em_real<span class="w"> </span>&gt;<span class="p">&amp;</span><span class="w"> </span>log.compile
</code></pre></div>
<p>This may take several hours to compile. Check the log file to ensure
that the compilation was successful.</p>
<h3 id="running-wrf-on-mahuika">Running WRF on Mahuika<a class="headerlink" href="#running-wrf-on-mahuika" title="Permanent link">&para;</a></h3>
<p>An example Slurm script for running WRF on Mahuika extension, which can
be submitted with <em>sbatch name_of_script.sl</em>:</p>
<div class="highlight"><pre><span></span><code>#!/bin/bash -e
#SBATCH --job-name=wrf
#SBATCH --time=01:00:00
#SBATCH --ntasks=240
#SBATCH --hint=nomultithread
#SBATCH --partition=milan

module purge
module load HDF5/1.12.2-iimpi-2022a
module list
export LD_LIBRARY_PATH=$WRF_DEPS_DIR/lib:$LD_LIBRARY_PATH

# run real
srun --output=real.log ./real.exe

# run wrf
srun --output=wrf.log ./wrf.exe
</code></pre></div>
<h2 id="wrf-on-maui">WRF on Māui<a class="headerlink" href="#wrf-on-maui" title="Permanent link">&para;</a></h2>
<h3 id="building-wrf">Building WRF<a class="headerlink" href="#building-wrf" title="Permanent link">&para;</a></h3>
<p>Load environment modules and set up the build environment (here we will
build with the Intel compiler):</p>
<div class="highlight"><pre><span></span><code># load PrgEnv-intel (this assumes you currently have PrgEnv-cray loaded)
module switch PrgEnv-cray PrgEnv-intel

# load dependencies
module load cray-netcdf cray-hdf5 cray-parallel-netcdf

# the following two lines are optional and may improve performance
module switch craype-x86-skylake craype-broadwell
module load craype-hugepages2M

export NETCDF=$NETCDF_DIR
export HDF5=$HDF5_DIR
export PNETCDF=$PNETCDF_DIR
</code></pre></div>
<p>Apply patches for Polar WRF if required and then configure WRF:</p>
<div class="highlight"><pre><span></span><code>./configure
<span class="c1"># choose option 50 - INTEL (ftn/icc) Cray XC (dmpar)</span>
<span class="c1"># choose an appropriate nesting option or leave it at the default</span>
</code></pre></div>
<p>The configure script takes some options, for example, to configure for a
debug build (no optimisations and debug symbols enabled) you could run
<em>./configure -d</em> instead.</p>
<p>The configure script writes out a <em>configure.wrf</em> file which can also be
edited manually if desired. For example, if you want an optimised build
with debug symbols included, you could add <em>-g</em> to the <em>FCDEBUG</em>
variable.</p>
<p>Next compile WRF:</p>
<div class="highlight"><pre><span></span><code>./compile<span class="w"> </span>em_real<span class="w"> </span>&gt;<span class="p">&amp;</span><span class="w"> </span>log.compile
</code></pre></div>
<p>It is important to check the output in <em>log.compile</em> as the command will
not exit with an error if it fails. Check the end of the log file for a
message saying compilation was successful. You could also check the
timestamps of the executables in the <em>main</em> subdirectory
(<em>main/wrf.exe</em>, <em>main/real.exe</em>, etc).</p>
<h3 id="running-wrf">Running WRF<a class="headerlink" href="#running-wrf" title="Permanent link">&para;</a></h3>
<p>An example Slurm script for running WRF on Māui, which can be submitted
with <em>sbatch name_of_script.sl</em>:</p>
<div class="highlight"><pre><span></span><code>#!/bin/bash -e
#SBATCH --job-name=wrf
#SBATCH --time=01:00:00
#SBATCH --ntasks=240
#SBATCH --hint=nomultithread

# important, required on Maui
export HDF5_USE_FILE_LOCKING=FALSE

# optional, may improve performance
module load craype-hugepages2M

# run real
srun --output=real.log ./real.exe

# run wrf
srun --output=wrf.log ./wrf.exe
</code></pre></div>
<h4 id="parallel-netcdf">Parallel netCDF<a class="headerlink" href="#parallel-netcdf" title="Permanent link">&para;</a></h4>
<p>For some model configurations enabling parallel IO can be beneficial. By
default WRF uses serial netCDF IO, which can be verified by looking in
the <em>namelist.input</em> file for the <em>io_form_*</em> variables (these will
mostly be in the <em>time_control</em> section of the namelist). If these
variables are set to "2" then they will use serial netCDF. Setting them
to 11 will use parallel netCDF instead. It is also recommended (possibly
required) to set <em>nocolons = .true.</em> in the <em>time_control</em> section of
the namelist when using parallel IO.</p>
<h3 id="building-wps">Building WPS<a class="headerlink" href="#building-wps" title="Permanent link">&para;</a></h3>
<p>Download WPS:</p>
<div class="highlight"><pre><span></span><code>wget<span class="w"> </span>https://github.com/wrf-model/WPS/archive/v4.2.tar.gz
tar<span class="w"> </span>xf<span class="w"> </span>v4.2.tar.gz
<span class="nb">cd</span><span class="w"> </span>WPS-4.2
</code></pre></div>
<p>Load environment modules and set up the build environment (here we will
build with the Intel compiler). We will build WPS using dynamic linking
so that we can link against the system JasPer shared library.</p>
<div class="highlight"><pre><span></span><code># load PrgEnv-intel (this assumes you currently have PrgEnv-cray loaded)
module switch PrgEnv-cray PrgEnv-intel

# load dependencies
module load cray-netcdf cray-hdf5 cray-parallel-netcdf

# the following two lines are optional and may improve performance
module switch craype-x86-skylake craype-broadwell
module load craype-hugepages2M

export NETCDF=$NETCDF_DIR
export HDF5=$HDF5_DIR
export PNETCDF=$PARALLEL_NETCDF_DIR
export JASPERLIB=/usr/lib/libjasper.so.1
export JASPERINC=/usr/include/jasper/jasper.h
export WRF_DIR=../WRF-4.1.1
export CRAYPE_LINK_TYPE=dynamic
</code></pre></div>
<p>Configure WPS:</p>
<div class="highlight"><pre><span></span><code>./configure
<span class="c1"># choose option 39 - Cray XC Intel parallel build</span>
</code></pre></div>
<p>This creates the <em>configure.wps</em> file, which can be edited in a similar
way to <em>configure.wrf</em> above, if desired.</p>
<p>Now compile WPS:</p>
<div class="highlight"><pre><span></span><code>./compile<span class="w"> </span>&gt;<span class="p">&amp;</span><span class="w"> </span>log.compile
</code></pre></div>
<p>Check that the executables were successfully created: <em>geogrid.exe</em>,
<em>ungrib.exe</em> and <em>metgrid.exe</em>.</p>
<h3 id="running-wps">Running WPS<a class="headerlink" href="#running-wps" title="Permanent link">&para;</a></h3>
<p>Both <em>geogrid</em> and <em>metgrid</em> are parallel applications and can be run on
Māui compute nodes. However, <em>ungrib</em> is serial and should not be run on
a compute node unless it is very quick to finish. Alternatively you
could run <em>ungrib</em> on an interactive/login node if it will not take up
many resources, or you could compile WRF and WPS on a Māui Ancillary
node and run it there.</p>
<p>Note that WPS does a lot of file IO and therefore probably won't scale
up to as many processes as WRF.</p>
<p>This example shows running <em>geogrid</em> in a Slurm job:</p>
<div class="highlight"><pre><span></span><code>#!/bin/bash -e
#SBATCH --job-name=wps
#SBATCH --time=01:00:00
#SBATCH --ntasks=40
#SBATCH --hint=nomultithread

# need to specify modules as we linked dynamically
module unload PrgEnv-cray PrgEnv-intel PrgEnv-gnu
module load PrgEnv-intel cray-netcdf cray-hdf5 cray-parallel-netcdf

# the following two lines are optional and may improve performance
module switch craype-x86-skylake craype-broadwell
module load craype-hugepages2M

# important, required on Maui
export HDF5_USE_FILE_LOCKING=FALSE

# run geogrid
srun --output=geogrid.log ./geogrid.exe
</code></pre></div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">December 21, 2023</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 17, 2023</span>
  </span>

    
    
    
  </aside>





                



              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
    <div id="new-footer">
        <div id="partners">
          <div id="logos">
            <a href="https://nesi.org.nz" class="nesi-footer-logo" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/LogoNeSI-footer.png"></a>
            <a href="http://www.mbie.govt.nz/" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/media/LogoMBIE.png"></a>
            <a href="https://www.auckland.ac.nz/" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/media/LogoUoA.png"></a>
            <a href="https://www.niwa.co.nz/" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/media/LogoNIWA.png"></a>
            <a href="https://www.otago.ac.nz/" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/media/LogoUoO.png"></a>
            <a href="http://www.landcareresearch.co.nz/" target="_blank"><img alt="" src="https://www.nesi.org.nz/sites/default/files/LogoManaakiWhenuaLandcareResearch.png"></a>
          </div>
        </div>
        <div id="inner">
          <span id="links"><a href="https://www.nesi.org.nz/copyright" target="_blank">Copyright © <span id="year">2023</span> · New Zealand eScience Infrastructure</a> | <a href="https://www.nesi.org.nz//disclaimer" target="_blank">Disclaimer</a> | <a href="https://www.nesi.org.nz//privacy" target="_blank">Privacy</a>
          </span>
        </div>
    </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.indexes", "navigation.top", "navigation.prune", "content.code.copy", "content.action.edit", "navigation.path"], "search": "../../../assets/javascripts/workers/search.c011b7c0.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.7389ff0e.min.js"></script>
      
        <script src="../../../assets/javascripts/general.js"></script>
      
    
  </body>
</html>